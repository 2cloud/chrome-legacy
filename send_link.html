<html>
  <head>
    <script type="text/javascript" src="functions.js"></script>
    <script type="text/javascript">
      function submitLink() {
        chrome.tabs.getSelected(null, dispatchLink);
      }
      function dispatchLink(tab) {
        var linkToSend = new Object();
        linkToSend.url = tab.url;
        linkToSend.target = document.getElementById("a2c_link.target").value;
        linkToSend.comment = document.getElementById("a2c_link.comment").value;
        linkToSend.callback = linkSent;
        background.window.sendLink(linkToSend);
        document.getElementById("a2c_link.target").value = "";
        document.getElementById("a2c_link.comment").value = "";
        document.getElementById('a2c_confirmation.url').innerHTML = linkToSend.url;
        document.getElementById('a2c_confirmation.target').innerHTML = linkToSend.target;
        document.getElementById('a2c_confirmation.comment').innerHTML = linkToSend.comment;
        if(linkToSend.comment != "")
          document.getElementById('a2c_confirmation.comment.p').style.display = "";
      }
      
      function linkSent(resp, xhr) {
        document.getElementById('a2c_send_link.beforeSend').style.display = "none";
        document.getElementById('a2c_send_link.afterSend').style.display = "";
        //window.close();
      }
      
      function toggleSink() {
        sinkElement = document.getElementById('a2c_send_link.kitchenSink');
        sinkLink = document.getElementById("a2c_send_link.kitchenSink.link");
        if(sinkLink.innerHTML == "[+]"){
          sinkLink.innerHTML = "[-]";
          sinkElement.style.display = "";
        }else{
          sinkLink.innerHTML = "[+]";
          sinkElement.style.display = "none";
        }
      }
      chrome.windows.getCurrent(function(window) { document.getElementById("a2c_window.id").innerHTML = background.window.channel.username + ":" + window.id; 
      document.getElementById("a2c_window.server").innerHTML = background.window.config.host; });
    </script>
  </head>
  <body>
  <div id="a2c_send_link.beforeSend">
    <p>Target: <input type="text" id="a2c_link.target" /></p>
    <p>Comment: <textarea id="a2c_link.comment"></textarea></p>
    <p><button onClick="submitLink();">Send</button><span style="float: right;"><a id="a2c_send_link.kitchenSink.link" href="#" onClick="toggleSink()">[+]</a></p>
    <div id="a2c_send_link.kitchenSink" style="display: none;">
      <p>User:<br /><span id="a2c_window.id" style="font-size: small;"></span></p>
      <p>Server:<br /><span id="a2c_window.server" style="font-size: small;"></span></p>
    </div>
  </div>
  <div id="a2c_send_link.afterSend" style="display: none;">
    <p>Sent <span id="a2c_confirmation.url"></span> to <span id="a2c_confirmation.target"></span>.</p>
    <p id="a2c_confirmation.comment.p">You said:<br /><br />"<span id="a2c_confirmation.comment"></span>"</p>
  </div>
  </body>
</html>
